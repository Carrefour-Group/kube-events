apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.5
  creationTimestamp: null
  name: kubeeventsexporters.logging.kubesphere.io
spec:
  group: logging.kubesphere.io
  names:
    kind: KubeEventsExporter
    listKind: KubeEventsExporterList
    plural: kubeeventsexporters
    singular: kubeeventsexporter
  scope: Namespaced
  validation:
    openAPIV3Schema:
      description: KubeEventsExporter is the Schema for the kubeeventsexporters API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: Spec defines the specification of the desired behavior of the
            KubeEventsExporter.
          properties:
            image:
              description: Docker image of kube-events-exporter
              type: string
            imagePullPolicy:
              description: Image pull policy. One of Always, Never, IfNotPresent.
              type: string
            resources:
              description: Resources defines resources requests and limits for single
                Pod.
              properties:
                limits:
                  additionalProperties:
                    anyOf:
                    - type: integer
                    - type: string
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  description: 'Limits describes the maximum amount of compute resources
                    allowed. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                  type: object
                requests:
                  additionalProperties:
                    anyOf:
                    - type: integer
                    - type: string
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  description: 'Requests describes the minimum amount of compute resources
                    required. If Requests is omitted for a container, it defaults
                    to Limits if that is explicitly specified, otherwise to an implementation-defined
                    value. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                  type: object
              type: object
            sinks:
              description: Sinks defines details of events sinks
              properties:
                stdout:
                  description: Stdout represents whether to write events to stdout.
                    Output when configure an empty struct `{}`, but do nothing when
                    no configuration
                  type: object
                webhooks:
                  description: Webhooks is a list of ExporterWebhookSink
                  items:
                    description: ExporterWebhookSink defines parameters for webhook
                      sink of Events Exporter.
                    properties:
                      service:
                        description: '`service` is a reference to the service for
                          this webhook. Either `service` or `url` must be specified.
                          If the webhook is running within the cluster, then you should
                          use `service`.'
                        properties:
                          name:
                            description: '`name` is the name of the service.'
                            type: string
                          namespace:
                            description: '`namespace` is the namespace of the service.'
                            type: string
                          path:
                            description: '`path` is an optional URL path which will
                              be sent in any request to this service.'
                            type: string
                          port:
                            description: '`port` is the port on the service and should
                              be a valid port number (1-65535, inclusive).'
                            type: integer
                        required:
                        - name
                        - namespace
                        type: object
                      url:
                        description: '`url` gives the location of the webhook, in
                          standard URL form (`scheme://host:port/path`). Exactly one
                          of `url` or `service` must be specified.'
                        type: string
                    type: object
                  type: array
              type: object
          required:
          - image
          type: object
        status:
          description: KubeEventsExporterStatus defines the observed state of KubeEventsExporter
          type: object
      required:
      - spec
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.5
  creationTimestamp: null
  name: kubeeventsrulers.logging.kubesphere.io
spec:
  group: logging.kubesphere.io
  names:
    kind: KubeEventsRuler
    listKind: KubeEventsRulerList
    plural: kubeeventsrulers
    singular: kubeeventsruler
  scope: Namespaced
  validation:
    openAPIV3Schema:
      description: KubeEventsRuler is the Schema for the kubeeventsrulers API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: Spec defines the specification of the desired behavior of the
            KubeEventsRuler.
          properties:
            image:
              description: Docker image of kube-events-exporter
              type: string
            imagePullPolicy:
              description: Image pull policy. One of Always, Never, IfNotPresent.
              type: string
            replicas:
              description: Number of desired pods. Defaults to 1.
              format: int32
              type: integer
            resources:
              description: Resources defines resources requests and limits for single
                Pod.
              properties:
                limits:
                  additionalProperties:
                    anyOf:
                    - type: integer
                    - type: string
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  description: 'Limits describes the maximum amount of compute resources
                    allowed. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                  type: object
                requests:
                  additionalProperties:
                    anyOf:
                    - type: integer
                    - type: string
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  description: 'Requests describes the minimum amount of compute resources
                    required. If Requests is omitted for a container, it defaults
                    to Limits if that is explicitly specified, otherwise to an implementation-defined
                    value. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                  type: object
              type: object
            ruleNamespaceSelector:
              description: Namespaces to be selected for KubeEventsRules discovery.
                If unspecified, discover KubeEventsRule instances from all namespaces.
              properties:
                matchExpressions:
                  description: matchExpressions is a list of label selector requirements.
                    The requirements are ANDed.
                  items:
                    description: A label selector requirement is a selector that contains
                      values, a key, and an operator that relates the key and values.
                    properties:
                      key:
                        description: key is the label key that the selector applies
                          to.
                        type: string
                      operator:
                        description: operator represents a key's relationship to a
                          set of values. Valid operators are In, NotIn, Exists and
                          DoesNotExist.
                        type: string
                      values:
                        description: values is an array of string values. If the operator
                          is In or NotIn, the values array must be non-empty. If the
                          operator is Exists or DoesNotExist, the values array must
                          be empty. This array is replaced during a strategic merge
                          patch.
                        items:
                          type: string
                        type: array
                    required:
                    - key
                    - operator
                    type: object
                  type: array
                matchLabels:
                  additionalProperties:
                    type: string
                  description: matchLabels is a map of {key,value} pairs. A single
                    {key,value} in the matchLabels map is equivalent to an element
                    of matchExpressions, whose key field is "key", the operator is
                    "In", and the values array contains only "value". The requirements
                    are ANDed.
                  type: object
              type: object
            ruleSelector:
              description: A selector to select KubeEventsRules instances.
              properties:
                matchExpressions:
                  description: matchExpressions is a list of label selector requirements.
                    The requirements are ANDed.
                  items:
                    description: A label selector requirement is a selector that contains
                      values, a key, and an operator that relates the key and values.
                    properties:
                      key:
                        description: key is the label key that the selector applies
                          to.
                        type: string
                      operator:
                        description: operator represents a key's relationship to a
                          set of values. Valid operators are In, NotIn, Exists and
                          DoesNotExist.
                        type: string
                      values:
                        description: values is an array of string values. If the operator
                          is In or NotIn, the values array must be non-empty. If the
                          operator is Exists or DoesNotExist, the values array must
                          be empty. This array is replaced during a strategic merge
                          patch.
                        items:
                          type: string
                        type: array
                    required:
                    - key
                    - operator
                    type: object
                  type: array
                matchLabels:
                  additionalProperties:
                    type: string
                  description: matchLabels is a map of {key,value} pairs. A single
                    {key,value} in the matchLabels map is equivalent to an element
                    of matchExpressions, whose key field is "key", the operator is
                    "In", and the values array contains only "value". The requirements
                    are ANDed.
                  type: object
              type: object
            sinks:
              description: Sinks defines sinks detail of this ruler
              properties:
                alertmanager:
                  description: Alertmanager is an alertmanager sink to which only
                    alerts can sink.
                  properties:
                    name:
                      description: '`name` is the name of the alertmanager service.'
                      type: string
                    namespace:
                      description: '`namespace` is the namespace of the alertmanager
                        service.'
                      type: string
                    port:
                      description: '`port` is the port on the alertmanager service.
                        Default to 9093. `port` should be a valid port number (1-65535,
                        inclusive).'
                      type: integer
                    targetPort:
                      description: TargetPort is the port to access on the backend
                        instances targeted by the alertmanager service. If this is
                        not specified, the value of the 'port' field is used.
                      type: integer
                  required:
                  - name
                  - namespace
                  type: object
                stdout:
                  description: Stdout can config write notifications or alerts to
                    stdout; do nothing when no configuration
                  properties:
                    type:
                      description: Type represents that the sink is for notification
                        or alert. Available values are `notification` and `alert`
                      type: string
                  required:
                  - type
                  type: object
                webhooks:
                  description: Webhooks is a list of RulerWebhookSink to which notifications
                    or alerts can sink
                  items:
                    description: RulerWebhookSink defines parameters for webhook sink
                      of Events Ruler.
                    properties:
                      service:
                        description: '`service` is a reference to the service for
                          this webhook. Either `service` or `url` must be specified.
                          If the webhook is running within the cluster, then you should
                          use `service`.'
                        properties:
                          name:
                            description: '`name` is the name of the service.'
                            type: string
                          namespace:
                            description: '`namespace` is the namespace of the service.'
                            type: string
                          path:
                            description: '`path` is an optional URL path which will
                              be sent in any request to this service.'
                            type: string
                          port:
                            description: '`port` is the port on the service and should
                              be a valid port number (1-65535, inclusive).'
                            type: integer
                        required:
                        - name
                        - namespace
                        type: object
                      type:
                        description: Type represents that the sink is for notification
                          or alert. Available values are `notification` and `alert`
                        type: string
                      url:
                        description: '`url` gives the location of the webhook, in
                          standard URL form (`scheme://host:port/path`). Exactly one
                          of `url` or `service` must be specified.'
                        type: string
                    required:
                    - type
                    type: object
                  type: array
              type: object
          required:
          - image
          type: object
        status:
          description: KubeEventsRulerStatus defines the observed state of KubeEventsRuler
          type: object
      required:
      - spec
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.2.5
  creationTimestamp: null
  name: kubeeventsrules.logging.kubesphere.io
spec:
  group: logging.kubesphere.io
  names:
    kind: KubeEventsRule
    listKind: KubeEventsRuleList
    plural: kubeeventsrules
    singular: kubeeventsrule
  scope: Namespaced
  validation:
    openAPIV3Schema:
      description: KubeEventsRule is the Schema for the kubeeventsrules API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: KubeEventsRuleSpec defines the desired state of KubeEventsRule
          properties:
            rules:
              items:
                description: Rule describes a notification or alert rule
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: 'Values of Annotations can use format string with
                      the fields of the event. For example: `{"message": "%event.message"}`'
                    type: object
                  condition:
                    description: 'Condition is a string similar with the where part
                      of sql (please use double quotation to mark a string). For example:
                      `event.type="Warning" and event.involvedObject.kind="Pod" and
                      event.reason="FailedMount"`'
                    type: string
                  enable:
                    description: Enable is whether to enable the rule
                    type: boolean
                  labels:
                    additionalProperties:
                      type: string
                    description: Labels
                    type: object
                  name:
                    description: Name is simple name of rule
                    type: string
                  type:
                    description: Type represents that the rule is for notification
                      or alert. Available values are `notification` and `alert`
                    type: string
                type: object
              type: array
          type: object
        status:
          description: KubeEventsRuleStatus defines the observed state of KubeEventsRule
          type: object
      required:
      - spec
      type: object
  version: v1alpha1
  versions:
  - name: v1alpha1
    served: true
    storage: true
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: kube-events-admission-mutate
webhooks:
- clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURaRENDQWt5Z0F3SUJBZ0lKQUpxYlYrTnBjeW5OTUEwR0NTcUdTSWIzRFFFQkN3VUFNRWN4Q3pBSkJnTlYKQkFZVEFrTk9NUXN3Q1FZRFZRUUlEQUpJUWpFTE1Ba0dBMVVFQ2d3Q1VVTXhIakFjQmdOVkJBTU1GV3QxWW1VdApaWFpsYm5SekxXRmtiV2x6YzJsdmJqQWVGdzB5TURBME1qUXdPRE16TUROYUZ3MDBOekE1TVRBd09ETXpNRE5hCk1FY3hDekFKQmdOVkJBWVRBa05PTVFzd0NRWURWUVFJREFKSVFqRUxNQWtHQTFVRUNnd0NVVU14SGpBY0JnTlYKQkFNTUZXdDFZbVV0WlhabGJuUnpMV0ZrYldsemMybHZiakNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUApBRENDQVFvQ2dnRUJBT29pRXp5ZUtxRnhwQ1czWEVQaHpud2pJS0I0ekRQd01qaDdjR3pyMUo2VFY5bitYSVpVCkpxcm1lSWZkelloejBhQVpMM2tVenZERVZ0TWVUNExiUG14V0V1VUkvRHdjcExGUjBZQzVkWnRHeFpEQk9IakUKa1NndXA2enJPUTFEa1FtamZ5cTVialpFSzJnd1YxZk5FZTc0SXlyUmsreWlHTzJmT0lETWJ0cndnZy9nckVIWAo5cnFqUk1BQVhoQkdCUjFpUzhhellUM2RkaHNvajdwQlM2WnFONjRIR2JTYXg1QVViQy9vbS9IaEZvVDlPSWNnClQvdXVYVVZqTFlHVVowRzEyZi9SM3BuL09waGUrTDNjbWdibUp1VXEwQit6RTByQTNTYmNzbWxMQ1JoS2htVlYKZ29WK0wraU1Xdzh3bHdNd0poRnVVY1BtRjhEaEkvL1RiRnNDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkxJNwo3K1JxNHRJOVQyeCsxektmTFZ4RmJPQUNNQjhHQTFVZEl3UVlNQmFBRkxJNzcrUnE0dEk5VDJ4KzF6S2ZMVnhGCmJPQUNNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBTGJEUFhaOUpOTFAKSGVOdDJCc3VSMWFGMGpYTWRMUC9GWHFqN01IWnV0c3B2RWFXNDh1bU14a1Y2c0sxOHB5Z2QvVWZ6S3NTOEFidApOQ0Q2K3p4clZ6bTVmalF6c2JUWEtXcDdseHNnZ0VuQXFWTlo0Qm1yNHpJYVRySE95R1dVNHRmL2czT2F1YjJxCnprd05yRGFEWi8yWDZIT1pONHFKSitXMEZqakxkNmJ3M3B6bGgyZlFTNFBIdlZFVTZ5UHlBV2dLb2FpZ0hnTmMKd2h5ZEJZenFSeWFVZWJsSzZOVEFKczJaMkd2ZVZjUS92V1paYzJQU2lhMVQ5bjNBelBVQWtBVTQ3UzVmaEJGVAptMjhkeHIxQVIzbVdMYjVqZDNkQkJiS2FMWDBoeENJeU5ndzVhdHpLTjR6QXlTOTBVanppWm42S1h6ekxLZ0dqCm02MWM2VVQyT1NVPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    service:
      name: kube-events-admission
      namespace: kubesphere-logging-system
      path: /mutate-logging-kubesphere-io-v1alpha1-kubeeventsrule
  failurePolicy: Fail
  name: mkubeeventsrule.kb.io
  rules:
  - apiGroups:
    - logging.kubesphere.io
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - kubeeventsrules
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kube-events-operator
  namespace: kubesphere-logging-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  creationTimestamp: null
  name: kube-events-operator
rules:
- apiGroups:
  - apps
  resources:
  - deployments
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apps
  resources:
  - deployments/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - apps
  resources:
  - services/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - logging.kubesphere.io
  resources:
  - kubeeventsexporters
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - logging.kubesphere.io
  resources:
  - kubeeventsexporters/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - logging.kubesphere.io
  resources:
  - kubeeventsrulers
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - logging.kubesphere.io
  resources:
  - kubeeventsrulers/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - logging.kubesphere.io
  resources:
  - kubeeventsrules
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - logging.kubesphere.io
  resources:
  - kubeeventsrules/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterrolebindings
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterroles
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kube-events-operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kube-events-operator
subjects:
- kind: ServiceAccount
  name: kube-events-operator
  namespace: kubesphere-logging-system
---
apiVersion: v1
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURLRENDQWhBQ0NRQ1c5QWIzYjFKRGdUQU5CZ2txaGtpRzl3MEJBUXNGQURCSE1Rc3dDUVlEVlFRR0V3SkQKVGpFTE1Ba0dBMVVFQ0F3Q1NFSXhDekFKQmdOVkJBb01BbEZETVI0d0hBWURWUVFEREJWcmRXSmxMV1YyWlc1MApjeTFoWkcxcGMzTnBiMjR3SGhjTk1qQXdOREkwTURnek16QXpXaGNOTkRjd09URXdNRGd6TXpBeldqQmxNUXN3CkNRWURWUVFHRXdKRFRqRUxNQWtHQTFVRUNBd0NTRUl4Q3pBSkJnTlZCQW9NQWxGRE1Ud3dPZ1lEVlFRRERETnIKZFdKbExXVjJaVzUwY3kxaFpHMXBjM05wYjI0dWEzVmlaWE53YUdWeVpTMXNiMmRuYVc1bkxYTjVjM1JsYlM1egpkbU13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQzBhQVVxWHFwK2RtcDNVR0svCndITWM0dG8wZTFkMzVqYTV5R0dlMG5PRm1XcG1QaVVxZklDR1VaYXlQdUJranhCbk4vSkdRSVpyazFGRk83eWwKNHZZSVpINVdXdTFZNG41MytTRjBIeXRlWGZzRUo4amNFc0RWWURYbHR4ZjIxbWYydmhRUU9TdW4wODRCSVlzbwpkbGFhazBiTUFiQ3o1VnVKRWsxRlNLa0tKYWtWazlwTVV2VlI5MGl0RW0zZjZjbVhLRWZqV0xmV21tWTYvcTNsCkxIcVBSSTRZR1NselFQdXFtQmEzTmlNY1prenh4U2QvZWZFQzVIZkJ0cFkyT0ZpNkRRVVBNY255bUtVSytFYkYKNmplNnBRdmR3MzFJOE1yUVNpNnllMGhrWWNYUEZCclVDVlZFUDREWXdGQ1B6VFJUQmc5SFRqUzV6RlpTOTQvLwp2Rk45QWdNQkFBRXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBT2VsUzMyYWc5Zm9aVFpFUGJnM0JBWFJ0OGEzCnMzakk0enZibGR3alFmbzJjYXR2enA2ZE5Jdy8xUDdpR0Y3dVhGdjVMc2RId21VczhPUExsU1VGSVlJTnEzUysKOTZod29yV2V3dW1YS1ZkcDFtT2R4aWpmYjZFeU90alVibThDbGR4WHA2T1dsdjByWkZFbGxpRTBLcEVPSWRDbwpoMUtHS1BqME96MC9SNlBxajIvSnByRnpxQlF0NHQveWJoeVRDenVMdUEyN1Zld1FlR1JyNU5MZzJ4YzhwRVp4CnFmM2pUVFpCTm5FeitjdkdqenowdlJQSmI2UGRFY2FEZzNOeHN3QWdyblhqQndSSzcwNHBhU3g4bXJhdVZLVm8KNkpVN2JiTGprSWJVUlp1SlhCai9xTDJWTmFMZzgxZ28vcVlGNzArTVluSUluT0NaNmpURXdtY1dMdEE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdEdnRktsNnFmblpxZDFCaXY4QnpIT0xhTkh0WGQrWTJ1Y2hobnRKemhabHFaajRsCktueUFobEdXc2o3Z1pJOFFaemZ5UmtDR2E1TlJSVHU4cGVMMkNHUitWbHJ0V09KK2Qva2hkQjhyWGwzN0JDZkkKM0JMQTFXQTE1YmNYOXRabjlyNFVFRGtycDlQT0FTR0xLSFpXbXBOR3pBR3dzK1ZiaVJKTlJVaXBDaVdwRlpQYQpURkwxVWZkSXJSSnQzK25KbHloSDQxaTMxcHBtT3Y2dDVTeDZqMFNPR0JrcGMwRDdxcGdXdHpZakhHWk04Y1VuCmYzbnhBdVIzd2JhV05qaFl1ZzBGRHpISjhwaWxDdmhHeGVvM3VxVUwzY045U1BESzBFb3VzbnRJWkdIRnp4UWEKMUFsVlJEK0EyTUJRajgwMFV3WVBSMDQwdWN4V1V2ZVAvN3hUZlFJREFRQUJBb0lCQUdydmliaE91dU1SVUJSLwpXcmxzMnc4UlRPUjFCQ2ozRmhOVHVzSEkzMThlekJuazFtVHp2YjlnbDJINnNVb0tIMS8vb3FXUDA5M3FTZTh1CjlLaWordENJdVBaNUdWMXBqQ3VUU2dncC9hd0hLeWFRYXBoQXFYc1JkNEU5NFgrWUliSDVnNjBHSm1GcHhCK1oKZ1lJdmV6QlBBbFVrMzFnVEtRbjhCajkrVFd6TVhSSUJwalBobCtDYURjcmExekEwL0s5RG56Sld6M0IrTHNaagpmZWFxWUtMUjdyenlCSEY3YkpvbjdKMHk2MmF1UEJCVWtMSCtpT0ZQSnZtbXhkS0orbEdiNVJHYjN3cDJLNWU5ClI1SWRHcDFGeDI0ZFgwMXQ0NVJjbzRHUndkMFFLeFk4MSt3M3ZFYW93c0lRVlVnWStnRUJTZWR3TzhVTVcrWmQKYVIzTXFrRUNnWUVBMzExR2FmeVlIandzOFcvZ3hyQ3ViQ292dWt0WGNOSXYrejM5NFVGdXppMUt1QmQ3T0NrRworc3c3MTVTRHlnYitDRStyQ3h5Q294Znc5TjR4SHp2Qk01T0NmSVZOc0tjWFJVY05qMlRDL05YZDFUUHZhamZkCmQvNDg4T3lHR2w2RVhiY2pMRkNLSStXdlBQMG5tdFJpVmN0clZTTzEyS2ZHNlFMQTlrbXF3bTBDZ1lFQXpzUHgKTkU1d2h0N3pBVHBBSzZLOVRuQStmVUE5YXpiQWxHOXkrWnZDTmp5WURPNDB6QmZMWmFOc1F3REdUOFNmbVZ0RwpqYW9MTlBUQUVYYTNYRndIOE1oc0I5T3ZpOVV3R3p5b3EzU25za202SkJtbDZMcEFaaFRRS08ySkIzZGRDK1c1CjVDNGlBRVBZL1RPU1kwbjJqSjNlcy80TzBBN3ZyalRaaUs1dXExRUNnWUJ3MFo0VlBuNWZGeW5rTVF3cGoyZ3EKUGd5cFhoQ21iYVBLbFA4ODNWM29TYndweThKekZWWHZLMlUyZUU4d3BlTjlzeS9EaHZ6OC84UzNDZHRwMlRhMgpwRlVPTEE2WG9XNEJrZWZwZTQxNVExU3VzWExHQmIyWk5CTDM1WisraGVyNW90empMekwyK3JaT2FkZXRQb1VFCnJLQmorb3VKQ1FWUkFCRVMxUmFvNlFLQmdDTklIaTJOd1BmU3JXYWxPUFA1TmhKZlp0cGFqdUJ2bkZiMzJZZXMKUTJ5YjFGcElmMnZnRjQ0RlgrRGpEZlBvbWs5QjJ2MHJhZlFrVzIzZmN4Um9nOVpiYk11OUhIUmc4VytFWDBlNgpoUzhRRTVvN1lpc2ZOUVAyUXpyb3BYeEhxdkh2eGxPZ1o1N2g5UEhuemUveFhBZk1uSWJjTUV6aWI1V3JZUDlJCnZJdXhBb0dCQUk5aUZERys2MTVJWWhyTFhlVEh6YjV3UkVlcjZVRzlydlFtMmN1NmlGTkF6OUhJbUJBeG8vNTMKS25sRmQvcmhDcUxUTTJDZlhHSzcvSnozV1hFaVA1Ni9mc1pPd2tiNklkQTF0aGUrRVVjU28wWjFaWnpPNmE0dApGemJLSzUvKzRWNDRTTUdLWGVKSlZDRk9RUlFTOGd0ZjIrbW9KUStNNVJha0YraUVkU0haCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
kind: Secret
metadata:
  name: kube-events-admission
  namespace: kubesphere-logging-system
type: Opaque
---
apiVersion: v1
kind: Service
metadata:
  name: kube-events-admission
  namespace: kubesphere-logging-system
spec:
  ports:
  - port: 443
    targetPort: 9443
  selector:
    app: kube-events-operator
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kube-events-operator
  namespace: kubesphere-logging-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kube-events-operator
  template:
    metadata:
      labels:
        app: kube-events-operator
    spec:
      containers:
      - args:
        - --config-reloader-image=jimmidyson/configmap-reload:v0.3.0
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: kubespheredev/kube-events-operator:v0.1.0
        name: events-operator
        ports:
        - containerPort: 9443
          name: webhook-server
          protocol: TCP
        resources:
          limits:
            cpu: 200m
            memory: 200Mi
          requests:
            cpu: 20m
            memory: 20Mi
        volumeMounts:
        - mountPath: /tmp/k8s-webhook-server/serving-certs
          name: cert
          readOnly: true
      serviceAccountName: kube-events-operator
      volumes:
      - name: cert
        secret:
          secretName: kube-events-admission
---
apiVersion: logging.kubesphere.io/v1alpha1
kind: KubeEventsExporter
metadata:
  name: kube-events-exporter
  namespace: kubesphere-logging-system
spec:
  image: kubespheredev/kube-events-exporter:v0.1.0
  resources:
    limits:
      cpu: 200m
      memory: 500Mi
    requests:
      cpu: 20m
      memory: 50Mi
  sinks:
    stdout: {}
    webhooks:
    - service:
        name: kube-events-ruler
        namespace: kubesphere-logging-system
        path: /events
        port: 8443
---
apiVersion: logging.kubesphere.io/v1alpha1
kind: KubeEventsRule
metadata:
  labels:
    kubesphere.io/rule-scope: cluster
  name: kube-events-cluster-rules-default
  namespace: kubesphere-logging-system
spec:
  rules:
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Created" and not event.involvedObject.fieldPath=""
    enable: true
    name: ContainerCreated
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Started" and not event.involvedObject.fieldPath=""
    enable: true
    name: ContainerStarted
    type: notification
  - annotations:
      message: '%event.message'
      summary: Container failed
      summaryCn: 容器失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="Failed" and not event.involvedObject.fieldPath=""
    enable: true
    labels:
      severity: warning
    name: ContainerFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Killing" and not event.involvedObject.fieldPath=""
    enable: true
    name: ContainerKilling
    type: notification
  - annotations:
      message: '%event.message'
      summary: Container is preemting
      summaryCn: 容器抢占中
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="Preempting"
    labels:
      severity: warning
    name: ContainerPreempting
    type: alert
  - annotations:
      message: '%event.message'
      summary: Container back-off
      summaryCn: 容器回退
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and reason="BackOff" and not event.involvedObject.fieldPath="" and event.count>3
    enable: true
    labels:
      severity: warning
    name: ContainerBackoff
    type: alert
  - annotations:
      message: '%event.message'
      summary: Container is unhealthy
      summaryCn: 容器状态不良
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="Unhealthy" and event.count>3
    enable: true
    labels:
      severity: warning
    name: ContainerUnhealthy
    type: alert
  - annotations:
      message: '%event.message'
      summary: Warning to perform a probe to the container
      summaryCn: 容器探测警告
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="ProbeWarning" and event.count>3
    enable: true
    labels:
      severity: warning
    name: ContainerProbeWarning
    type: alert
  - annotations:
      message: '%event.message'
      summary: Pod killing exceeded specified grace period
      summaryCn: pod终止超时
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="ExceededGracePeriod"
    enable: true
    labels:
      severity: warning
    name: PodKillingExceededGracePeriod
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to kill pod
      summaryCn: pod终止失败
    condition: |
      event.type="Warning" and event.reason="FailedKillPod"
    enable: true
    labels:
      severity: warning
    name: PodKillFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to create pod container
      summaryCn: pod容器创建失败
    condition: |
      event.type="Warning" and event.reason="FailedCreatePodContainer"
    enable: true
    labels:
      severity: warning
    name: PodContainerCreateFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Pod failed
      summaryCn: pod失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="Failed" and event.involvedObject.fieldPath=""
    enable: true
    labels:
      severity: warning
    name: PodFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Pod network is not ready
      summaryCn: Pod网络异常
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="NetworkNotReady"
    enable: true
    labels:
      severity: warning
    name: PodNetworkNotReady
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Pulling"
    enable: true
    name: ImagePulling
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Pulled"
    enable: true
    name: ImagePulled
    type: notification
  - annotations:
      message: '%event.message'
      summary: Wrong image pull policy
      summaryCn: 镜像拉取策略错误
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="ErrImageNeverPull"
    enable: true
    labels:
      severity: warning
    name: ImagePullPolicyError
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to inspect image
      summaryCn: 镜像检查失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="InspectFailed"
    enable: true
    labels:
      severity: warning
    name: ImageInspectFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Node" and event.reason="NodeReady"
    enable: true
    name: NodeReady
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Node" and event.reason="NodeNotReady"
    enable: true
    name: NodeNotReady
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Node" and event.reason="NodeSchedulable"
    enable: true
    name: NodeSchedulable
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Node" and event.reason="NodeNotSchedulable"
    enable: true
    name: NodeNotSchedulable
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Node" and event.reason="Starting"
    enable: true
    name: KubeletStarting
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to setup kubelet
      summaryCn: kubelet安装失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Node" and event.reason="KubeletSetupFailed"
    enable: true
    labels:
      severity: warning
    name: KubeletSetupFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to attach volume
      summaryCn: 存储卷装载失败
    condition: |
      event.type="Warning" and event.reason="FailedAttachVolume"
    enable: true
    labels:
      severity: warning
    name: VolumeAttachFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to mount volume
      summaryCn: 存储卷挂载失败
    condition: |
      event.type="Warning" and event.reason="FailedMount"
    enable: true
    labels:
      severity: warning
    name: VolumeMountFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to expand/reduce volume
      summaryCn: 存储卷扩缩容失败
    condition: |
      event.type="Warning" and event.reason="VolumeResizeFailed"
    enable: true
    labels:
      severity: warning
    name: VolumeResizeFailed
    type: alert
  - condition: |
      event.type="Normal" and event.reason="VolumeResizeSuccessful"
    enable: true
    name: VolumeResizeSuccess
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to expand/reduce file system
      summaryCn: 文件系统扩缩容失败
    condition: |
      event.type="Warning" and event.reason="FileSystemResizeFailed"
    enable: true
    labels:
      severity: warning
    name: FileSystemResizeFailed
    type: alert
  - condition: |
      event.type="Normal" and event.reason="FileSystemResizeSuccessful"
    enable: true
    name: FileSystemResized
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to map volume
      summaryCn: 存储卷映射失败
    condition: |
      event.type="Warning" and event.reason="FailedMapVolume"
    enable: true
    labels:
      severity: warning
    name: VolumeMapFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Volume is already mounted
      summaryCn: 存储卷已被挂载
    condition: |
      event.type="Warning" and event.reason="AlreadyMountedVolume"
    enable: true
    labels:
      severity: warning
    name: VolumeAlreadyMounted
    type: alert
  - condition: |
      event.type="Normal" and event.reason="SuccessfulAttachVolume"
    enable: true
    name: VolumeAttached
    type: notification
  - condition: |
      event.type="Normal" and event.reason="SuccessfulMountVolume"
    enable: true
    name: VolumeMounted
    type: notification
  - annotations:
      message: '%event.message'
      summary: Node Rebooted
      summaryCn: 节点重启
    condition: |
      event.type="Warning" and event.involvedObject.kind="Node" and event.reason="Rebooted"
    enable: true
    labels:
      severity: warning
    name: NodeRebooted
    type: alert
  - annotations:
      message: '%event.message'
      summary: Container GC failed
      summaryCn: 容器GC失败
    condition: |
      event.type="Warning" and event.reason="ContainerGCFailed"
    enable: true
    labels:
      severity: warning
    name: ContainerGCFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Image GC failed
      summaryCn: 镜像GC失败
    condition: |
      event.type="Warning" and event.reason="ImageGCFailed"
    enable: true
    labels:
      severity: warning
    name: ImageGCFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Node allocatable enforcement failed
      summaryCn: 节点可分配资源更新失败
    condition: |
      event.type="Warning" and event.reason="FailedNodeAllocatableEnforcement"
    enable: true
    labels:
      severity: warning
    name: NodeAllocatableEnforcementFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Node" and event.reason="NodeAllocatableEnforced"
    enable: true
    name: NodeAllocatableEnforcedSuccess
    type: notification
  - condition: |
      event.type="Normal" and event.reason="SandboxChanged"
    enable: true
    name: SandboxChanged
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to create sandbox
      summaryCn: Sandbox创建失败
    condition: |
      event.type="Warning" and event.reason="FailedCreatePodSandBox"
    enable: true
    labels:
      severity: warning
    name: SandboxCreateFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to get sandbox status
      summaryCn: 获取Sandbox状态错误
    condition: |
      event.type="Warning" and event.reason="FailedPodSandBoxStatus"
    enable: true
    labels:
      severity: warning
    name: SandboxStatusFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Invalid disk capacity
      summaryCn: 磁盘容量配置不合法
    condition: |
      event.type="Warning" and event.reason="InvalidDiskCapacity"
    enable: true
    labels:
      severity: warning
    name: DiskCapacityInvalid
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to free disk space
      summaryCn: 磁盘空间释放失败
    condition: |
      type="Warning" and reason="FreeDiskSpaceFailed"
    enable: true
    labels:
      severity: warning
    name: DiskSpaceFreeFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed To Sync Pod Status
      summaryCn: Pod状态同步失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="FailedSync"
    enable: true
    labels:
      severity: warning
    name: PodStatusSyncFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Configuration Validation Failed
      summaryCn: 配置验证失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="FailedValidation"
    enable: true
    labels:
      severity: warning
    name: ConfigurationValidationFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to postStart LifecycleHook
      summaryCn: 容器启动后的生命周期钩子运行失败
    condition: |
      event.type="Warning" and event.reason="FailedPostStartHook"
    enable: true
    labels:
      severity: warning
    name: LifecycleHookPostStartFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to preStop LifecycleHook
      summaryCn: 容器停止前的生命周期钩子运行失败
    condition: |
      event.type="Warning" and event.reason="FailedPreStopHook"
    enable: true
    labels:
      severity: warning
    name: LifecycleHookPreStopFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: HPA selector error
      summaryCn: HPA选择器错误
    condition: |
      event.type="Warning" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason in ("SelectorRequired","InvalidSelector")
    enable: true
    labels:
      severity: warning
    name: HPASelectorError
    type: alert
  - annotations:
      message: '%event.message'
      summary: HPA metric error
      summaryCn: HPA对象指标错误
    condition: |
      event.type="Warning" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason in ("FailedGetObjectMetric","InvalidMetricSourceType")
    enable: true
    labels:
      severity: warning
    name: HPAMetricError
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to convert HPA
      summaryCn: HPA转换失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason="FailedConvertHPA"
    enable: true
    labels:
      severity: warning
    name: HPAConvertFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to get HPA scale
      summaryCn: HPA规模获取失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason="FailedGetScale"
    enable: true
    labels:
      severity: warning
    name: HPAGetScaleFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to compute HPA replicas
      summaryCn: HPA副本计算失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason="FailedComputeMetricsReplicas"
    enable: true
    labels:
      severity: warning
    name: HPAComputeReplicasFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to rescale HPA size
      summaryCn: HPA规模调整失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason="FailedRescale"
    enable: true
    labels:
      severity: warning
    name: HPARescaleFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="HorizontalPodAutoscaler" and event.reason="SuccessfulRescale"
    enable: true
    name: HPARescaleSuccess
    type: notification
  - annotations:
      message: '%event.message'
      summary: Node system OOM encountered
      summaryCn: 节点内存溢出
    condition: |
      event.type="Warning" and event.involvedObject.kind="Node" and event.reason="SystemOOM"
    enable: true
    labels:
      severity: warning
    name: NodeSystemOOM
    type: alert
  - annotations:
      message: '%event.message'
      summary: Volume binding failed
      summaryCn: 存储卷绑定失败
    condition: |
      event.type="Warning" and event.reason="FailedBinding"
    enable: true
    labels:
      severity: warning
    name: VolumeBindingFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Volume Mismatch
      summaryCn: 存储卷不匹配
    condition: |
      event.type="Warning" and event.reason="VolumeMismatch"
    enable: true
    labels:
      severity: warning
    name: VolumeMismatch
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to recycle volume
      summaryCn: 存储卷回收失败
    condition: |
      event.type="Warning" and event.reason="VolumeFailedRecycle"
    enable: true
    labels:
      severity: warning
    name: VolumeRecycleFailed
    type: alert
  - condition: |
      event.type="Normal" and event.reason="VolumeRecycled"
    enable: true
    name: VolumeRecycled
    type: notification
  - annotations:
      message: '%event.message'
      summary: Volume Recycler pod error
      summaryCn: 存储卷回收器错误
    condition: |
      event.type="Warning" and event.reason="RecyclerPod"
    enable: true
    labels:
      severity: warning
    name: VolumeRecyclerPodError
    type: alert
  - condition: |
      event.type="Normal" and event.reason="VolumeDelete"
    enable: true
    name: VolumeDeleted
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to delete volume
      summaryCn: 存储卷删除失败
    condition: |
      event.type="Warning" and event.reason="VolumeFailedDelete"
    enable: true
    labels:
      severity: warning
    name: VolumeDeleteFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to provision volume
      summaryCn: 存储申请失败
    condition: |
      event.type="Warning" and event.reason="ProvisioningFailed"
    enable: true
    labels:
      severity: warning
    name: VolumeProvisionFailed
    type: alert
  - condition: |
      event.type="Normal" and event.reason="ProvisioningSucceeded"
    enable: true
    name: VolumeProvisioned
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to provision volume
      summaryCn: 清理存储失败
    condition: |
      event.type="Warning" and event.reason="ProvisioningCleanupFailed"
    enable: true
    labels:
      severity: warning
    name: VolumeProvisionCleanupFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Error for volume external expanding
      summaryCn: 存储外部扩展错误
    condition: |
      event.type="Warning" and event.reason="ExternalExpanding"
    enable: true
    labels:
      severity: warning
    name: VolumeExternalExpandingError
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to schedule pod
      summaryCn: pod调度失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="Pod" and event.reason="FailedScheduling"
    enable: true
    labels:
      severity: warning
    name: PodScheduleFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Preempted"
    enable: true
    name: PodSchedulePreempted
    type: notification
  - condition: |
      event.type="Normal" and event.involvedObject.kind="Pod" and event.reason="Scheduled"
    enable: true
    name: PodScheduled
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to create pod
      summaryCn: pod创建失败
    condition: |
      event.type="Warning" and event.involvedObject.kind in ("Pod","ReplicaSet","DaemonSet","StatefulSet","Job") and event.reason="FailedCreate"
    enable: true
    labels:
      severity: warning
    name: PodCreateFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind in ("Pod","ReplicaSet","DaemonSet","StatefulSet","Job") and event.reason="SuccessfulCreate"
    enable: true
    name: PodCreated
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to delete pod
      summaryCn: pod删除失败
    condition: |
      event.type="Warning" and event.involvedObject.kind in ("Pod","ReplicaSet","DaemonSet","StatefulSet","Job") and event.reason="FailedDelete"
    enable: true
    labels:
      severity: warning
    name: PodDeleteFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind in ("Pod","ReplicaSet","DaemonSet","StatefulSet","Job") and event.reason="SuccessfulDelete"
    enable: true
    name: PodDeleted
    type: notification
  - annotations:
      message: '%event.message'
      summary: Error to create replica set for deployment
      summaryCn: 副本集创建错误
    condition: |
      event.type="Warning" and event.reason="ReplicaSetCreateError"
    enable: true
    labels:
      severity: warning
    name: ReplicaSetCreateError
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to rollback deployment
      summaryCn: 部署回滚失败
    condition: |
      event.type="Warning" and event.reason in("DeploymentRollbackRevisionNotFound","DeploymentRollbackTemplateUnchanged")
    enable: true
    labels:
      severity: warning
    name: DeploymentRollbackFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: The deploy is selecting all pods
      summaryCn: deploy选择了所有pod
    condition: |
      event.type="Warning" and event.involvedObject.kind="Deployment" and event.reason="SelectingAll"
    enable: true
    labels:
      severity: warning
    name: DeploySelectorAll
    type: alert
  - annotations:
      message: '%event.message'
      summary: The daemon set is selecting all pods
      summaryCn: daemonset选择了所有pod
    condition: |
      event.type="Warning" and event.involvedObject.kind="DaemonSet" and event.reason="SelectingAll"
    enable: true
    labels:
      severity: warning
    name: DaemonSelectorAll
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed daemon pod
      summaryCn: daemonset的pod失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="DaemonSet" and event.reason in ("FailedDaemonPod","FailedPlacement")
    enable: true
    labels:
      severity: warning
    name: DaemonPodFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Error syncing load balancer
      summaryCn: 负载据衡器不可用
    condition: |
      event.type="Warning" and event.reason="SyncLoadBalancerFailed"
    enable: true
    labels:
      severity: warning
    name: LoadBalancerSyncFailed
    type: alert
  - condition: |
      event.type="Normal" and event.reason="DeletingLoadBalancer"
    enable: true
    name: LoadBalancerDeleting
    type: notification
  - condition: |
      event.type="Normal" and event.reason="EnsuringLoadBalancer"
    enable: true
    name: LoadBalancerEnsuring
    type: notification
  - condition: |
      event.type="Normal" and event.reason="EnsuredLoadBalancer"
    enable: true
    name: LoadBalancerEnsured
    type: notification
  - annotations:
      message: '%event.message'
      summary: Load balancer is not available
      summaryCn: 负载据衡器不可用
    condition: |
      event.type="Warning" and event.reason="UnAvailableLoadBalancer"
    enable: true
    labels:
      severity: warning
    name: LoadBalancerUnAvailable
    type: alert
  - condition: |
      event.type="Normal" and event.reason="UpdatedLoadBalancer"
    enable: true
    name: LoadBalancerUpdated
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to update load balancer
      summaryCn: 更新负载据衡器失败
    condition: |
      event.type="Warning" and event.reason="UpdateLoadBalancerFailed"
    enable: true
    labels:
      severity: warning
    name: LoadBalancerUpdateFailed
    type: alert
  - condition: |
      event.type="Normal" and event.reason="DeletingLoadBalancer"
    enable: true
    name: LoadBalancerDeleting
    type: notification
  - condition: |
      event.type="Normal" and event.reason="DeletedLoadBalancer"
    enable: true
    name: LoadBalancerDeleted
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to delete load balancer
      summaryCn: 负载据衡器删除失败
    condition: |
      event.type="Warning" and event.reason="DeleteLoadBalancerFailed"
    enable: true
    labels:
      severity: warning
    name: LoadBalancerDeleteFailed
    type: alert
  - annotations:
      message: '%event.message'
      summary: Failed to get job
      summaryCn: 任务获取失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="CronJob" and event.reason="FailedGet"
    enable: true
    labels:
      severity: warning
    name: JobGetFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="CronJob" and event.reason="SuccessfulCreate"
    enable: true
    name: JobCreated
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to create job
      summaryCn: 任务创建失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="CronJob" and event.reason="FailedCreate"
    enable: true
    labels:
      severity: warning
    name: JobCreateFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="CronJob" and event.reason="SuccessfulDelete"
    enable: true
    name: JobDeleted
    type: notification
  - annotations:
      message: '%event.message'
      summary: Failed to delete job
      summaryCn: 任务删除失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="CronJob" and event.reason="FailedDelete"
    enable: true
    labels:
      severity: warning
    name: JobDeleteFailed
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="CronJob" and event.reason="SawCompletedJob"
    enable: true
    name: JobCompleted
    type: notification
  - annotations:
      message: '%event.message'
      summary: CronJob saw unexpected job
      summaryCn: 任务非预期
    condition: |
      event.type="Warning" and event.involvedObject.kind="CronJob" and event.reason="UnexpectedJob"
    enable: true
    labels:
      severity: warning
    name: JobUnexpected
    type: alert
  - condition: |
      event.type="Normal" and event.involvedObject.kind="CronJob" and event.reason="MissingJob"
    enable: true
    name: JobMissing
    type: notification
  - annotations:
      message: '%event.message'
      summary: CronJob failed to schedule job
      summaryCn: 任务调度失败
    condition: |
      event.type="Warning" and event.involvedObject.kind="CronJob" and event.reason in ("MissSchedule","FailedNeedsStart")
    enable: true
    labels:
      severity: warning
    name: JobScheduleFailed
    type: alert
---
apiVersion: logging.kubesphere.io/v1alpha1
kind: KubeEventsRuler
metadata:
  name: kube-events-ruler
  namespace: kubesphere-logging-system
spec:
  image: kubespheredev/kube-events-ruler:v0.1.0
  resources:
    limits:
      cpu: 500m
      memory: 500Mi
    requests:
      cpu: 50m
      memory: 50Mi
  sinks:
    alertmanager:
      name: alertmanager-main
      namespace: kubesphere-monitoring-system
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: kube-events-admission-validate
webhooks:
- clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURaRENDQWt5Z0F3SUJBZ0lKQUpxYlYrTnBjeW5OTUEwR0NTcUdTSWIzRFFFQkN3VUFNRWN4Q3pBSkJnTlYKQkFZVEFrTk9NUXN3Q1FZRFZRUUlEQUpJUWpFTE1Ba0dBMVVFQ2d3Q1VVTXhIakFjQmdOVkJBTU1GV3QxWW1VdApaWFpsYm5SekxXRmtiV2x6YzJsdmJqQWVGdzB5TURBME1qUXdPRE16TUROYUZ3MDBOekE1TVRBd09ETXpNRE5hCk1FY3hDekFKQmdOVkJBWVRBa05PTVFzd0NRWURWUVFJREFKSVFqRUxNQWtHQTFVRUNnd0NVVU14SGpBY0JnTlYKQkFNTUZXdDFZbVV0WlhabGJuUnpMV0ZrYldsemMybHZiakNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUApBRENDQVFvQ2dnRUJBT29pRXp5ZUtxRnhwQ1czWEVQaHpud2pJS0I0ekRQd01qaDdjR3pyMUo2VFY5bitYSVpVCkpxcm1lSWZkelloejBhQVpMM2tVenZERVZ0TWVUNExiUG14V0V1VUkvRHdjcExGUjBZQzVkWnRHeFpEQk9IakUKa1NndXA2enJPUTFEa1FtamZ5cTVialpFSzJnd1YxZk5FZTc0SXlyUmsreWlHTzJmT0lETWJ0cndnZy9nckVIWAo5cnFqUk1BQVhoQkdCUjFpUzhhellUM2RkaHNvajdwQlM2WnFONjRIR2JTYXg1QVViQy9vbS9IaEZvVDlPSWNnClQvdXVYVVZqTFlHVVowRzEyZi9SM3BuL09waGUrTDNjbWdibUp1VXEwQit6RTByQTNTYmNzbWxMQ1JoS2htVlYKZ29WK0wraU1Xdzh3bHdNd0poRnVVY1BtRjhEaEkvL1RiRnNDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkxJNwo3K1JxNHRJOVQyeCsxektmTFZ4RmJPQUNNQjhHQTFVZEl3UVlNQmFBRkxJNzcrUnE0dEk5VDJ4KzF6S2ZMVnhGCmJPQUNNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBTGJEUFhaOUpOTFAKSGVOdDJCc3VSMWFGMGpYTWRMUC9GWHFqN01IWnV0c3B2RWFXNDh1bU14a1Y2c0sxOHB5Z2QvVWZ6S3NTOEFidApOQ0Q2K3p4clZ6bTVmalF6c2JUWEtXcDdseHNnZ0VuQXFWTlo0Qm1yNHpJYVRySE95R1dVNHRmL2czT2F1YjJxCnprd05yRGFEWi8yWDZIT1pONHFKSitXMEZqakxkNmJ3M3B6bGgyZlFTNFBIdlZFVTZ5UHlBV2dLb2FpZ0hnTmMKd2h5ZEJZenFSeWFVZWJsSzZOVEFKczJaMkd2ZVZjUS92V1paYzJQU2lhMVQ5bjNBelBVQWtBVTQ3UzVmaEJGVAptMjhkeHIxQVIzbVdMYjVqZDNkQkJiS2FMWDBoeENJeU5ndzVhdHpLTjR6QXlTOTBVanppWm42S1h6ekxLZ0dqCm02MWM2VVQyT1NVPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    service:
      name: kube-events-admission
      namespace: kubesphere-logging-system
      path: /validate-logging-kubesphere-io-v1alpha1-kubeeventsrule
  failurePolicy: Fail
  name: vkubeeventsrule.kb.io
  rules:
  - apiGroups:
    - logging.kubesphere.io
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - kubeeventsrules
